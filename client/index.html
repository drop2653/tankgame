<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Circle Shooter</title>
  <style>
    html, body { margin: 0; background: #111; overflow: hidden; }
    canvas { display: block; background: #222; }
  </style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const bullets = [];
let angle = 0;
let mouse = { x: 400, y: 300 };
const socket = new WebSocket("wss://your-server-url");

const myId = Math.random().toString(36).slice(2);
const players = {};

const player = {
  id: myId,
  x: 400,
  y: 300,
};

canvas.addEventListener("mousemove", (e) => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
});

window.addEventListener("keydown", (e) => {
  if (e.code === "Space") {
    const dx = mouse.x - player.x;
    const dy = mouse.y - player.y;
    const len = Math.hypot(dx, dy);
    bullets.push({ x: player.x, y: player.y, vx: dx/len * 400, vy: dy/len * 400, owner: myId });

    socket.send(JSON.stringify({
      type: "shoot",
      x: player.x,
      y: player.y,
      vx: dx/len * 400,
      vy: dy/len * 400,
    }));
  }
});

socket.addEventListener("open", () => {
  console.log("서버 연결됨");
  socket.send(JSON.stringify({ type: "join", id: myId }));
});

socket.addEventListener("message", (event) => {
  const msg = JSON.parse(event.data);
  if (msg.type === "players") {
    Object.assign(players, msg.players);
  }
  if (msg.type === "shoot" && msg.id !== myId) {
    bullets.push({ x: msg.x, y: msg.y, vx: msg.vx, vy: msg.vy, owner: msg.id });
  }
});

function update(dt) {
  bullets.forEach(b => {
    b.x += b.vx * dt;
    b.y += b.vy * dt;
  });
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 내 플레이어
  ctx.fillStyle = "lime";
  ctx.beginPath();
  ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
  ctx.fill();

  // 타 플레이어
  for (let id in players) {
    if (id !== myId) {
      const p = players[id];
      ctx.fillStyle = "red";
      ctx.beginPath();
      ctx.arc(p.x, p.y, 20, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  // 총알
  ctx.fillStyle = "white";
  bullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, 4, 0, Math.PI * 2);
    ctx.fill();
  });
}

let last = performance.now();
function loop(now) {
  const dt = (now - last) / 1000;
  last = now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
